:root {
    --bg: #090909;
    --card: #141414;
    --gold: #FFD700;
    --text: #fff;
    --font: 'Inter', sans-serif;
    
    --c-consumer: #B0B0B0;   /* Ширп */
    --c-common: #4CAF50;     /* Обычный */
    --c-rare: #2196F3;       /* Редкий */
    --c-epic: #9C27B0;       /* Эпик */
    --c-legendary: #FFD700;  /* Легендарный */
    --c-mythical: #FF0000;   /* МИФИЧЕСКИЙ */
}

* { box-sizing: border-box; }

body {
    background: var(--bg);
    color: var(--text);
    font-family: var(--font);
    margin: 0;
    overflow-x: hidden;
    -webkit-tap-highlight-color: transparent;
    padding-bottom: 120px;
    min-height: 100vh;
}

body::before {
    content: '';
    position: fixed;
    top: -50%; left: -50%; width: 200%; height: 200%;
    background: radial-gradient(circle, rgba(156, 39, 176, 0.08) 0%, transparent 60%),
                radial-gradient(circle at 80% 80%, rgba(33, 150, 243, 0.05) 0%, transparent 50%);
    z-index: -1;
    pointer-events: none;
}

/* BLUR CONTAINER */
#blur-container {
    transition: filter 0.4s ease, transform 0.4s ease;
    will-change: filter, transform;
    height: 100vh;
    overflow-y: scroll;
}

.app-blurred {
    filter: blur(12px) brightness(0.5); /* Усиленное размытие */
    transform: scale(0.98);
    pointer-events: none;
    overflow: hidden; /* Блокируем скролл фона */
}

/* Header */
header { display: flex; justify-content: space-between; padding: 16px; background: rgba(20,20,20,0.8); backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 10; border-bottom: 1px solid rgba(255,255,255,0.05); }

.user-pill, .balance-pill { 
    background: rgba(255,255,255,0.05); padding: 6px 12px; border-radius: 20px; 
    display: flex; align-items: center; gap: 8px; font-size: 13px; font-weight: 600; 
    border: 1px solid rgba(255,255,255,0.05); cursor: pointer;
}
#header-avatar { width: 28px; height: 28px; border-radius: 50%; object-fit: cover; background: #333; }
.balance-pill { color: var(--gold); border-color: rgba(255, 215, 0, 0.2); }
.uid-tag { font-size: 10px; color: var(--c-rare); display: block; }
.add-btn { background: var(--gold); color: black; width: 18px; height: 18px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-weight: bold; }

/* Sections */
.section { display: none; padding: 20px 16px; animation: fade 0.3s; padding-bottom: 40px;}
.section.active { display: block; }
@keyframes fade { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

.hero-banner { text-align: center; margin-bottom: 25px; }
.hero-banner h1 { margin: 0; background: linear-gradient(90deg, #fff, #999); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.hero-banner p { color: #666; font-size: 13px; margin: 5px 0 0; }

/* Grids */
.cases-grid, .shop-grid, .inventory-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

/* Базовые карточки магазина и кейсов */
.case-card, .shop-card { 
    background: linear-gradient(160deg, #1a1a1a, #111); border-radius: 16px; padding: 15px; 
    text-align: center; border: 1px solid rgba(255,255,255,0.05); position: relative; overflow: hidden; transition: transform 0.1s;
}
.case-card:active, .shop-card:active { transform: scale(0.96); }
.shop-card.popular { border: 1px solid var(--c-rare); box-shadow: 0 0 15px rgba(33, 150, 243, 0.15); }
.shop-card.premium { border: 1px solid var(--gold); box-shadow: 0 0 15px rgba(255, 215, 0, 0.15); }

.inventory-card {
    background: #141414;
    border: 1px solid #333;
    border-radius: 12px;
    padding: 10px;
    text-align: center;
    position: relative;
    cursor: pointer;
    transition: transform 0.1s;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    align-items: center;
    min-height: 120px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
}
.inventory-card:active { transform: scale(0.97); }
.inventory-card img {
    width: 100%; height: 60px; object-fit: contain; margin-bottom: 8px;
    filter: drop-shadow(0 2px 5px rgba(0,0,0,0.5));
}
.inv-name {
    font-size: 11px; font-weight: 700; color: #fff; line-height: 1.2;
    margin-bottom: 4px; width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.inv-price {
    font-size: 10px; color: #aaa; background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px; width: fit-content;
}

/* ЦВЕТА И ФОНЫ ДЛЯ РЕДКОСТЕЙ */
.inventory-card.rarity-consumer { border: 1px solid var(--c-consumer); }
.inventory-card.rarity-common { border: 1px solid var(--c-common); }
.inventory-card.rarity-rare { border: 1px solid var(--c-rare); }
.inventory-card.rarity-epic { border: 1px solid var(--c-epic); }
.inventory-card.rarity-legendary { 
    border: 1px solid var(--c-legendary);
    background: radial-gradient(circle at center, rgba(255, 215, 0, 0.15) 0%, #141414 70%);
    box-shadow: inset 0 0 15px rgba(255, 215, 0, 0.05);
}
.inventory-card.rarity-legendary .inv-name { color: var(--c-legendary); }
.inventory-card.rarity-mythical { 
    border: 1px solid var(--c-mythical);
    background: radial-gradient(circle at center, rgba(255, 0, 0, 0.2) 0%, #141414 75%);
    box-shadow: inset 0 0 15px rgba(255, 0, 0, 0.1);
    animation: mythPulseBorder 3s infinite ease-in-out;
}
.inventory-card.rarity-mythical .inv-name { color: var(--c-mythical); text-shadow: 0 0 5px rgba(255, 0, 0, 0.5); }
@keyframes mythPulseBorder {
    0% { box-shadow: inset 0 0 15px rgba(255, 0, 0, 0.1), 0 0 5px rgba(255,0,0,0.1); }
    50% { box-shadow: inset 0 0 25px rgba(255, 0, 0, 0.2), 0 0 10px rgba(255,0,0,0.3); }
    100% { box-shadow: inset 0 0 15px rgba(255, 0, 0, 0.1), 0 0 5px rgba(255,0,0,0.1); }
}

.badge { position: absolute; top: 0; right: 0; background: var(--gold); color: black; font-size: 10px; font-weight: 900; padding: 3px 8px; border-radius: 0 0 0 8px; }
.case-img { width: 100%; height: 80px; object-fit: contain; margin-bottom: 10px; filter: drop-shadow(0 5px 10px rgba(0,0,0,0.5)); }
.amount { font-size: 20px; font-weight: 800; color: #fff; margin-bottom: 5px; }
.cost { color: #888; font-size: 12px; }

/* --- Bottom Nav --- */
.bottom-nav { 
    position: fixed; bottom: 0; left: 0; width: 100%; background: #111; 
    border-top: 1px solid rgba(255,255,255,0.1); display: grid; grid-template-columns: 1fr 1fr 1fr; 
    padding: 10px 10px 25px 10px; z-index: 1000; padding-bottom: calc(15px + env(safe-area-inset-bottom));
    box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
}
.nav-btn { 
    background: none; border: none; color: #666; font-weight: 600; font-size: 10px; 
    display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 6px; 
    padding: 5px 0; cursor: pointer;
}
.nav-btn .icon { font-size: 20px; transition: 0.3s; }
.nav-btn.active { color: var(--gold); }
.nav-btn.active .icon { transform: translateY(-3px); filter: drop-shadow(0 0 5px rgba(255,215,0,0.5)); }

/* Buttons */
.btn-main { background: var(--gold); border: none; width: 100%; padding: 14px; border-radius: 12px; font-weight: 900; font-size: 10px; text-transform: uppercase; color: black; cursor: pointer; }
.btn-sec { background: #333; color: white; border: none; width: 100%; padding: 14px; border-radius: 12px; font-weight: 600; cursor: pointer; }
.btn-small-danger { background: #ff4d4d; color: white; border: none; padding: 5px 10px; border-radius: 8px; font-size: 10px; font-weight: bold; cursor: pointer; }
.pulse-btn { animation: pulse 2s infinite; }
@keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(255, 215, 0, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); } }

/* === ROULETTE SYSTEM === */
.roulette-fullscreen {
    display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
    background: rgba(0, 0, 0, 0.85); /* Полупрозрачный фон */
    backdrop-filter: blur(5px); /* Доп блюр */
    z-index: 3000;
    flex-direction: column; justify-content: center; align-items: center;
    animation: fadeIn 0.4s ease-in-out;
}
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

.roulette-status { position: absolute; bottom: 80px; z-index: 10; color: #fff; font-size: 18px; letter-spacing: 4px; font-weight: 900; text-shadow: 0 4px 10px rgba(0,0,0,0.8); }

/* Grid container for multiple roulettes */
.roulette-playground {
    width: 100%; height: 100%;
    display: flex;
    justify-content: center; align-items: center;
    padding: 20px;
    box-sizing: border-box;
}

/* Dynamic Grid Classes for Roulette */
.r-grid-1 { width: 100%; }
.r-grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; }

/* Десктопная версия x5 (остается плиткой) */
.r-grid-5 { display: grid; grid-template-columns: 1fr 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 10px; width: 100%; }
.r-grid-5 .roulette-window:nth-child(4) { grid-column: 1 / 2; transform: translateX(50%); } 
.r-grid-5 .roulette-window:nth-child(5) { grid-column: 2 / 3; transform: translateX(50%); } 

/* Mobile adaptation for x5/x10 - ИСПРАВЛЕНИЕ СЪЕЗЖАНИЯ */
@media (max-width: 600px) {
    .roulette-status { bottom: 30px; font-size: 14px; }
    
    .r-grid-5 { 
        display: flex; 
        flex-direction: column; 
        gap: 8px; 
        justify-content: center; 
        height: 100%;
        padding: 40px 0; /* Отступ сверху/снизу */
    }
    
    /* Уменьшаем высоту окон для мобилок */
    .r-grid-5 .roulette-window {
        height: 85px; /* Компактный размер */
        width: 100%;
    }
    
    /* Убираем странные трансформации с десктопа */
    .r-grid-5 .roulette-window:nth-child(4),
    .r-grid-5 .roulette-window:nth-child(5) {
        transform: none;
        grid-column: auto;
    }
    
    /* Уменьшаем сами карточки внутри рулетки на мобиле */
    .r-grid-5 .roulette-card {
        width: 75px; 
        min-width: 75px; 
        height: 65px;
    }
    .r-grid-5 .roulette-card img {
        width: 45px; height: 35px;
    }
    .r-grid-5 .roulette-card span {
        font-size: 7px;
    }
    
    /* x10 Режим для мобилок */
    .r-grid-10 { 
        display: grid; 
        grid-template-columns: 1fr 1fr; 
        gap: 5px; 
        height: 85vh; 
        overflow-y: auto; 
        align-content: start;
    }
}

/* Individual Roulette Box */
.roulette-window { 
    width: 100%; height: 120px; 
    background: #111; 
    position: relative; 
    display: flex; align-items: center; 
    overflow: hidden; 
    border-radius: 12px;
    border: 1px solid #333;
    box-shadow: 0 4px 10px rgba(0,0,0,0.5);
}

.roulette-track { display: flex; height: 100%; will-change: transform; align-items: center; }

.roulette-card {
    min-width: 104px; width: 104px; height: 90px; margin: 0; /* Margin included in width via gap calculation or explicit setting here */
    box-sizing: border-box;
    display: flex; flex-direction: column; justify-content: center; align-items: center;
    background: #1e1e1e; border-right: 1px solid #111; border-bottom: 3px solid #333; position: relative;
}
.roulette-card img { width: 60px; height: 40px; object-fit: contain; margin-bottom: 5px; }
.roulette-card span { font-size: 8px; color: #ccc; text-transform: uppercase; max-width: 90%; text-overflow: ellipsis; overflow: hidden; white-space: nowrap; }

/* RARITY COLORS FOR ROULETTE CARDS */
.roulette-card.rarity-consumer { border-bottom-color: var(--c-consumer); }
.roulette-card.rarity-common { border-bottom-color: var(--c-common); }
.roulette-card.rarity-rare { border-bottom-color: var(--c-rare); background: radial-gradient(circle at center, rgba(33,150,243,0.1), #1e1e1e); }
.roulette-card.rarity-epic { border-bottom-color: var(--c-epic); background: radial-gradient(circle at center, rgba(156,39,176,0.1), #1e1e1e); }
.roulette-card.rarity-legendary { border-bottom-color: var(--c-legendary); background: radial-gradient(circle at center, rgba(255,215,0,0.15), #1e1e1e); }
.roulette-card.rarity-mythical { 
    border-bottom-color: var(--c-mythical); 
    background: radial-gradient(circle at center, rgba(255,0,85,0.2), #1e1e1e);
    box-shadow: inset 0 0 10px rgba(255,0,85,0.1);
}

/* Center Line for each roulette */
.roulette-center-line {
    position: absolute; left: 50%; top: 0; bottom: 0; width: 2px; background: var(--gold);
    z-index: 20; transform: translateX(-50%);
    box-shadow: 0 0 10px var(--gold);
}

.roulette-shadow-overlay { position: absolute; inset: 0; pointer-events: none; z-index: 10; background: linear-gradient(90deg, #111 0%, transparent 20%, transparent 80%, #111 100%); }

/* === MODALS & PREVIEW === */
.modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 2000; justify-content: center; align-items: center; }
.modal-card { background: #181818; width: 90%; padding: 20px; border-radius: 24px; text-align: center; border: 1px solid #333; position: relative; display: flex; flex-direction: column; max-height: 80vh; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); align-items: center; overflow: hidden; }
@keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
.close-icon { position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.1); border: none; color: white; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; z-index: 5; }

/* FIX: Размер превью кейса */
.preview-case-img {
    width: 140px; 
    height: 140px; 
    object-fit: contain; 
    margin: 0 auto 10px auto; 
    display: block; 
    filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.2));
}

.preview-header { width: 100%; text-align: center; }

/* Qty Selector */
.qty-selector { margin-top: 20px; display: flex; gap: 8px; width: 100%; margin-bottom: 15px; }
.qty-btn { flex: 1; background: #222; border: 1px solid #333; color: #888; padding: 10px; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s; }
.qty-btn.active { background: var(--gold); color: black; border-color: var(--gold); }

/* PREVIEW GRID FIX */
.preview-grid-container {
    flex: 1;
    overflow-y: auto; /* Vertical scroll */
    background: #111;
    border-radius: 12px;
    padding: 10px;
    margin-bottom: 15px;
    border: 1px solid #222;
    width: 100%;
}

.preview-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr); /* 3 in a row */
    gap: 8px;
}

.preview-item {
    background: #1a1a1a; border-radius: 8px; padding: 8px 4px; 
    display: flex; flex-direction: column; align-items: center; justify-content: space-between; 
    height: 100px; border: 1px solid #333;
}
.preview-item img { width: 100%; height: 40px; object-fit: contain; margin-bottom: 5px; }
.preview-item .p-name { font-size: 9px; color: #ccc; line-height: 1.1; margin-bottom: 2px; overflow: hidden; text-align: center; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; }
.preview-item .p-price { font-size: 9px; color: #666; font-weight: bold; }

.preview-item.rarity-consumer { border-color: var(--c-consumer); }
.preview-item.rarity-common { border-color: var(--c-common); }
.preview-item.rarity-rare { border-color: var(--c-rare); }
.preview-item.rarity-epic { border-color: var(--c-epic); }
.preview-item.rarity-legendary { border-color: var(--c-legendary); }
.preview-item.rarity-mythical { border-color: var(--c-mythical); box-shadow: 0 0 5px rgba(255,0,85,0.4); }

.preview-footer { width: 100%; margin-top: auto; }

/* WIN GRID (For Multi Win) */
.win-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
    gap: 10px;
    width: 100%;
    max-height: 300px;
    overflow-y: auto;
    margin: 15px 0;
    z-index: 2; position: relative;
}
.win-grid-item {
    background: #111; border: 1px solid #333; border-radius: 8px; padding: 8px; text-align: center;
}
.win-grid-item img { width: 100%; height: 40px; object-fit: contain; }
.win-grid-item .w-name { font-size: 10px; color: white; margin-top: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

/* Win Actions */
.win-actions { display: flex; gap: 10px; margin-top: 20px; align-items: center; width: 100%; }
.stat-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #333; font-size: 14px; }
.payment-check { margin-top: 20px; padding-top: 15px; border-top: 1px dashed #333; text-align: center; font-size: 12px; color: #666; }

/* EFFECTS */
.win-effects-container {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    width: 600px; height: 600px; z-index: 1; pointer-events: none; display: none; 
}
.sunburst {
    width: 100%; height: 100%;
    background: conic-gradient(from 0deg, transparent 0deg, var(--effect-color) 20deg, transparent 40deg, var(--effect-color) 60deg, transparent 80deg, var(--effect-color) 100deg, transparent 120deg, var(--effect-color) 140deg, transparent 160deg, var(--effect-color) 180deg, transparent 200deg, var(--effect-color) 220deg, transparent 240deg, var(--effect-color) 260deg, transparent 280deg, var(--effect-color) 300deg, transparent 320deg, var(--effect-color) 340deg, transparent 360deg);
    opacity: 0.6; animation: spinBurst 12s linear infinite;
    mask-image: radial-gradient(circle, rgba(0,0,0,0) 10%, black 100%); -webkit-mask-image: radial-gradient(circle, rgba(0,0,0,0) 10%, black 100%);
    position: absolute; top:0; left:0;
}
.win-pulse {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: radial-gradient(circle, var(--effect-color) 0%, transparent 60%);
    opacity: 0.3; animation: pulseBg 2s ease-in-out infinite;
}
@keyframes spinBurst { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
@keyframes pulseBg { 0% { transform: scale(0.8); opacity: 0.2; } 50% { transform: scale(1.1); opacity: 0.4; } 100% { transform: scale(0.8); opacity: 0.2; } }

.effect-legendary { --effect-color: var(--gold); }
.effect-mythical { --effect-color: #ff0055; }
.shake-hard { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
@keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }

/* Toggle & Custom Pay */
.fast-open-toggle {
    display: flex; align-items: center; justify-content: center;
    gap: 10px; margin-top: 15px; margin-bottom: 5px; font-size: 13px; color: #ccc;
    cursor: pointer; padding: 5px; width: 100%;
}
.switch { position: relative; display: inline-block; width: 34px; height: 20px; }
.switch input { opacity: 0; width: 0; height: 0; }
.slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #333; transition: .4s; border-radius: 34px; }
.slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
input:checked + .slider { background-color: var(--gold); }
input:checked + .slider:before { transform: translateX(14px); background-color: black; }

.custom-pay-block {
    margin-top: 20px; padding-top: 15px;
    display: flex; gap: 8px; margin-bottom: 20px;
    background: #1a1a1a; padding: 10px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1);
}
.custom-pay-input {
    flex: 1; background: #111; border: 1px solid #333; color: white;
    padding: 12px; border-radius: 8px; outline: none; font-size: 14px;
}
.btn-pay-custom {
    background: #ffcc00; color: black; border: none; font-weight: bold;
    padding: 0 15px; border-radius: 8px; cursor: pointer; font-size: 12px;
}